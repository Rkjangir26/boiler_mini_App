<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Telegram Mini Apps with TON Connect</title>
    <style>
        /* (CSS styles remain the same as in the previous file) */
    </style>
</head>

<body>
    <main>
        <div align="center">
            <a href="https://ton.org/"><img width="48" src="./assets/tapps.png" alt="logo of telegram web apps"></a>
        </div>

        <h1>TON Connect</h1>
        <div id="ton-connect"></div>
        <button onclick="connectToWallet()">Connect Wallet</button>
        <button onclick="sendTransaction()">Send Transaction</button>
        <button onclick="disconnectWallet()">Disconnect Wallet</button>

        <h1>Modals</h1>
        <button onclick="Telegram.WebApp.showAlert('Hello World!');">Launch Alert</button>
        <button onclick="showPopup();">Launch Popup</button>

        <!-- Other sections (Links, Buttons, etc.) remain unchanged -->
    </main>

    <!-- Scripts -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tonconnect/ui"></script>
    <script>
        // Initialize TON Connect
        const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
            manifestUrl: 'https://rkjangir26.github.io/boiler_mini_App/tonconnect-manifest.json',
            buttonRootId: 'ton-connect'
        });

        async function connectToWallet() {
            try {
                console.log("Opening wallet selection popup...");
                // Trigger wallet connection flow (shows all available wallets)
                const connectedWallet = await tonConnectUI.connectWallet({
                    uiPreferences: {
                        forceModal: true, // Ensures the wallet selection modal is shown
                    }
                });

                console.log("Wallet connected:", connectedWallet);
                Telegram.WebApp.showAlert(`Wallet connected: ${connectedWallet.address}`);
            } catch (error) {
                console.error("Wallet connection failed:", error);
                Telegram.WebApp.showAlert("Wallet connection failed. Please try again.");
            }
        }

        async function sendTransaction() {
            const transaction = {
                messages: [
                    {
                        address: "EQABa48hjKzg09hN_HjxOic7r8T1PleIy1dRd8NvZ3922MP0",
                        amount: "20000000" // Toncoin in nanotons
                    }
                ]
            };

            try {
                console.log("Sending transaction...");
                const result = await tonConnectUI.sendTransaction(transaction);
                console.log("Transaction result:", result);
                Telegram.WebApp.showAlert("Transaction sent successfully!");
            } catch (error) {
                console.error("Transaction failed:", error);
                Telegram.WebApp.showAlert("Transaction failed. Please try again.");
            }
        }

        async function disconnectWallet() {
            try {
                console.log("Disconnecting wallet...");
                await tonConnectUI.disconnect();
                console.log("Wallet disconnected");
                Telegram.WebApp.showAlert("Wallet disconnected.");
            } catch (error) {
                console.error("Error disconnecting wallet:", error);
            }
        }

        // Initialize Telegram Web App
        Telegram.WebApp.ready();
        Telegram.WebApp.MainButton.setParams({ text: 'Main Button' });
        Telegram.WebApp.MainButton.show();

        function toggleMainButton() {
            if (Telegram.WebApp.MainButton.isVisible) {
                Telegram.WebApp.MainButton.hide();
            } else {
                Telegram.WebApp.MainButton.show();
            }
        }

        function showPopup() {
            Telegram.WebApp.showPopup({
                title: 'Title',
                message: 'Some message',
                buttons: [
                    { id: 'link', type: 'default', text: 'Open ton.org' },
                    { type: 'cancel' }
                ]
            }, function (btn) {
                if (btn === 'link') {
                    Telegram.WebApp.openLink('https://ton.org/');
                }
            });
        }
    </script>

    <!-- Eruda is a console for mobile browsers -->
    <script src="https://cdn.jsdelivr.net/npm/eruda"></script>
    <script>eruda.init();</script>
</body>
</html>
